<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Liga MX Pro – Frontend Stats (Direct EA)</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #0b1320;
      color: #eaeaea;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    .subtitle {
      text-align: center;
      color: #9aa4bf;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #111a2e;
      border-radius: 8px;
      overflow: hidden;
    }

    thead {
      background: #1b2a4a;
    }

    th, td {
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }

    th {
      cursor: pointer;
      font-size: 12px;
      text-transform: uppercase;
      color: #cfd6ff;
    }

    tbody tr:nth-child(even) {
      background: #0f1a33;
    }

    tbody tr:hover {
      background: #1c2b4d;
    }

    .error {
      text-align: center;
      color: #ff6b6b;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1>Soccer FC</h1>
<div class="subtitle">Frontend-only · Direct EA API (testing)</div>

<table id="statsTable" style="display:none;">
  <thead>
    <tr>
      <th onclick="sortBy('name')">Player</th>
      <th onclick="sortBy('pos')">Pos</th>
      <th onclick="sortBy('games')">GP</th>
      <th onclick="sortBy('goals')">Goals</th>
      <th onclick="sortBy('assists')">Assists</th>
      <th onclick="sortBy('rating')">Rating</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<div id="error" class="error"></div>

<script>
  // EA ENDPOINTS YOU PROVIDED
  const PLAYER_STATS_URL = "https://proclubs.ea.com/api/fc/members/stats?platform=common-gen5&clubId=1275113";
  const FRIENDLY_MATCHES_URL = "https://proclubs.ea.com/api/fc/clubs/matches?matchType=friendlyMatch&platform=common-gen5&clubIds=1275113";

  let players = [];
  let sortKey = 'goals';
  let sortDir = 'desc';

  async function loadPlayers() {
    try {
      const res = await fetch(PLAYER_STATS_URL, {
        method: 'GET',
        headers: {
          // These are BROWSER headers only – EA may still block via CORS
          'Accept': 'application/json, text/plain, */*',
          'Accept-Language': 'en-US,en;q=0.9'
        }
      });

      if (!res.ok) throw new Error('Request blocked');

      const data = await res.json();

      players = data.members.map(p => ({
        name: p.proName || p.name,
        pos: p.favoritePosition,
        games: Number(p.gamesPlayed),
        goals: Number(p.goals),
        assists: Number(p.assists),
        rating: Number(p.ratingAve)
      }));

      render();
      document.getElementById('statsTable').style.display = 'table';
    } catch (err) {
      document.getElementById('error').innerText =
        'EA blocked this request (CORS). This works for local testing or extensions, but production requires Render proxy.';
    }
  }

  function sortBy(key) {
    if (sortKey === key) {
      sortDir = sortDir === 'asc' ? 'desc' : 'asc';
    } else {
      sortKey = key;
      sortDir = 'desc';
    }
    render();
  }

  function render() {
    players.sort((a, b) => {
      return sortDir === 'asc' ? a[sortKey] - b[sortKey] : b[sortKey] - a[sortKey];
    });

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    players.forEach(p => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.name}</td>
        <td>${p.pos}</td>
        <td>${p.games}</td>
        <td>${p.goals}</td>
        <td>${p.assists}</td>
        <td>${p.rating.toFixed(1)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  loadPlayers();
</script>

</body>
</html>
